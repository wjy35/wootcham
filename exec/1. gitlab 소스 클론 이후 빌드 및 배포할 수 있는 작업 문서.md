## ⚒️ 사용한 기술 스택 및 버전

### OS

- windows 10
- Ubuntu 20.04 LTS

### IDE

- Intellij IDE 2023.1.3
- Visual Studio Code 1.81.1

### Database

- MySQL 8.1.0

### Infra

- docker 24.0.5
- docker-compose 2.20.2
- jenkins 2.401.3

### Frontend

- HTML, CSS
- JavaScript
- Vue 3.2.37
- Node.js 16.16.0
- Openvidu 2.28.0
- face-api.js 0.22.2
- vuex 4.1.0
- Stomp.js

### Backend

- Zulu OpenJDK 11
- Spring Boot 2.7.2
- Gradle 8.2.1
- QueryDSL 5.0.0
- spring boot starter mail 2.7.0
- Swagger 2.8.0

## 💻 배포 시 특이사항

- letsencrypt를 통한 ssl 설정
- nginx를 통한 리버스 프록시 설정 (ec2 /etc/nginx/conf.d/default.conf)
  ```
  upstream client {
    server 0.0.0.0:3000;
  }
  
  upstream api_server {
    server 0.0.0.0:8080;
  }
  
  upstream game_server {
    server 0.0.0.0:8090;
  }
  
  server {
    listen 80;
    server_name 43.201.249.175 www.wootcham.com wootcham.com;
  
    location / {
      return 301 https://wootcham.com$request_uri;
    }
  }
  
  server {
    listen 443 ssl;
    server_name www.wootcham.com wootcham.com;
  
    ssl on;
    ssl_certificate /etc/letsencrypt/live/wootcham.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/wootcham.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
  
    location /game {
      rewrite ^/game(/.*)$ $1 break;
      proxy_pass http://game_server;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  
    location /api {
      rewrite ^/api(/.*)$ $1 break;
      proxy_pass http://api_server;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

  location / {
    # root /app;
    # index index.html;
    # try_files $uri $uri/ /index.html;

    # if (!-e $request_filename) {
    #   rewrite https://$server_name break;
    # }

    proxy_pass http://client;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
  ```

- docker-compose를 통한 컨테이너 다중 실행

- Jenkins pipeline을 통한 CI/CD

- ufw-docker를 통한 방화벽 설정

## 📀 DB 접속 계정

- **public IP** 43.201.249.175
- **id** ssafy
- **password** ssafya604

## ⚙️ 빌드 시 사용되는 환경 변수 및 프로퍼티 파일 목록

### client

- **.env** (.gitignore에 포함된 파일)
  ```
  VUE_APP_MATCH_ENDPOINT_URL="wss://wootcham.com/game/endpoint"
  ```

### api server

- **application.properties** (/Back/api/wcc/src/main/resources/)

  ```
  spring.config.import=env.properties

  # database: 사용하는 DB에 관한 정보
  spring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver
  spring.datasource.url=${DB_URL}
  spring.datasource.hikari.username=${DB_USER}
  spring.datasource.hikari.password=${DB_PASSWORD}

  # jpa: Spring Data JPA 초기화 전략
  spring.jpa.hibernate.ddl-auto=none

  spring.jpa.show-sql=true
  spring.jpa.properties.hibernate.format_sql=true

  # redis: 캐싱을 위한 redis 정보
  spring.redis.host=${REDIS_HOST}
  spring.redis.port=${REDIS_PORT}

  # Swagger: RESTful API 문서 자동화 도구
  springfox.documentation.swagger.use-model-v3=false
  spring.mvc.pathmatch.matching-strategy=ant_path_matcher

  # logging: logging leverl 설정
  logging.level.com.ssafy.wcc=info

  # email: email 전송을 위한 정보
  spring.mail.host=${MAIL_HOST}
  spring.mail.port=${MAIL_PORT}
  spring.mail.username=${MAIL_USER}
  spring.mail.password=${MAIL_PASSWORD}
  spring.mail.properties.debug=true
  spring.mail.properties.mail.smtp.auth=true
  spring.mail.properties.mail.smtp.ssl.enable= true
  spring.mail.properties.mail.smtp.starttls.enable=true
  spring.mail.properties.mail.smtp.ssl.trust=smtp.naver.com

  # error code: Exception handler 처리
  server.error.include-exception=false
  server.error.include-message=always
  server.error.include-stacktrace=on_param
  server.error.whitelabel.enabled=true
  ```

- **env.properties** (.gitignore에 포함된 파일)

  ```
  # DB
  DB_URL=jdbc:mysql://wcc_mysql:3306/wcc?serverTimezone=UTC&useUniCode=yes&characterEncoding=UTF-8
  DB_USER=ssafy
  DB_PASSWORD=ssafya604

  # redis
  REDIS_HOST=wcc_api_cache
  REDIS_PORT=6379

  # Spring security
  spring.security.user.name=user
  spring.security.user.password=1234

  # email
  MAIL_HOST=smtp.naver.com
  MAIL_PORT=465
  MAIL_USER=0943315@naver.com
  MAIL_PASSWORD=BonBon!1

  # jwt
  jwt.salt=bigbigsecret
  jwt.expmin=3600000
  ```

### game server

- **application.properties** (/Back/game/game/src/main/resources/)

  ```
  spring.config.import=env.properties

  # database: 사용하는 DB에 관한 정보
  spring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver
  spring.datasource.url=${DB_URL}
  spring.datasource.hikari.username=${DB_USER}
  spring.datasource.hikari.password=${DB_PASSWORD}

  # jpa: Spring Data JPA 초기화 전략
  spring.jpa.hibernate.ddl-auto=none
  spring.jpa.show-sql=true
  spring.jpa.properties.hibernate.format_sql=true
  logging.level.org.hibernate.type.descriptor.sql=trace
  ```

- **env.properties** (.gitignore에 포함된 파일)

  ```
   # DB
   DB_URL=jdbc:mysql://wcc_mysql:3306/wcc?serverTimezone=UTC&useUniCode=yes&characterEncoding=UTF-8
   DB_USER=ssafy
   DB_PASSWORD=ssafya604

   # OpenVidu: openvidu를 사용하기 위한 도메인 정보
   OPENVIDU_URL=https://i9a604.p.ssafy.io:8443
   OPENVIDU_SECRET=wcc
  ```
